<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: awk | 吴文洁]]></title>
  <link href="http://www.wuwenjie.tk/blog/categories/awk/atom.xml" rel="self"/>
  <link href="http://www.wuwenjie.tk/"/>
  <updated>2014-07-15T18:40:34+08:00</updated>
  <id>http://www.wuwenjie.tk/</id>
  <author>
    <name><![CDATA[wuwenjie]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[gnuplot绘图工具简单使用和simple cat]]></title>
    <link href="http://www.wuwenjie.tk/blog/2013/06/29/gnuplothui-tu-gong-ju-jian-dan-shi-yong-he-simple-cat/"/>
    <updated>2013-06-29T20:10:00+08:00</updated>
    <id>http://www.wuwenjie.tk/blog/2013/06/29/gnuplothui-tu-gong-ju-jian-dan-shi-yong-he-simple-cat</id>
    <content type="html"><![CDATA[<h1>gnuplot绘图工具简单使用</h1>

<h2>安装</h2>

<ul>
<li>sudo apt-get install gnuplot</li>
</ul>


<h2>使用</h2>

<ul>
<li>$ gnuplot</li>
<li>使用实例:<a href="http://www.ibm.com/developerworks/cn/linux/l-gnuplot/">gnuplot 让您的数据可视化</a></li>
</ul>


<!-- more -->


<h2>我的实例</h2>

<ul>
<li>画<a href="http://quote.eastmoney.com/sh600600.html">600600青岛啤酒</a>走势图和5日<a href="http://zh.wikipedia.org/zh/%E7%A7%BB%E5%8B%95%E5%B9%B3%E5%9D%87">简单移动平均线</a>

<ul>
<li>600600青岛啤酒的<a href="https://mega.co.nz/#!F4AFjaDA!S0qSqRGszmWqQdA6fQUBsl-C0bJhJtXAvvnOwEjWGAo">日线资料(19930827-20130628)</a>从<a href="http://www.qianlong.com.cn/">钱龙</a>下载</li>
<li>用<a href="https://projects.gnome.org/gnumeric/">Gnumeric</a>或<a href="http://community.wps.cn/download/">Kingsoft Spreadsheet</a>打开并另存为<a href="http://zh.wikipedia.org/wiki/CSV">CSV格式</a></li>
<li>型如

<pre><code>  * 时间,涨跌,幅度%,开盘,最高,最低,收盘,成交量,成交额
  * 1993/08/27,+0.00,+0.00,15,15.3,13.45,14,168226,24084
  * 1993/08/30,-0.74,-5.29,13.7,13.7,13.17,13.26,32937,4442
  * 1993/08/31,-0.36,-2.71,13.18,13.37,12.8,12.9,31062,4051
</code></pre>

<p>  删除第一行，600600.csv</p></li>
<li>使用cut截取 时间

<ul>
<li><code>shell
  cut -d , -f 1,7 600600.csv &gt;600600.txt
</code></li>
<li>型如

<pre><code>  * 1993/08/27,14
  * 1993/08/30,13.26
  * 1993/08/31,12.9
  * 1993/09/01,12.92
</code></pre></li>
</ul>
</li>
<li><p>使用SHELL生成移动平均线数据文本600600ma5.txt
```bash
      #!/bin/sh
      #MA 5
      #
      I=1;
      FileTime=&ldquo;&rdquo;;
      FileNum=0;
      OUT=0;
      NA=0;
      NB=0;
      NC=0;
      ND=0; #前四天数值
      NE=0;</p>

<pre><code>  while read list
  do
      FileNum=`echo $list |cut -d , -f 2 `;   #截取
      FileTime="`echo $list |cut -d , -f 1 `";

      if [  $(($I%5)) -eq 1 ] # =
          then 
          NA=$FileNum;
      elif [  $(($I%5)) -eq 2 ]
          then 
          NB=$FileNum;
      elif [  $(($I%5)) -eq 3 ]
          then 
          NC=$FileNum;
      elif [  $(($I%5)) -eq 4 ]
          then 
          ND=$FileNum;
      elif [  $(($I%5)) -eq 0 ]
          then 
          NE=$FileNum;
      fi

      if [ $I -ge 5 ]
          then    
          OUT=`awk ' BEGIN { print ('$NA'+'$NB'+'$NC'+'$ND'+'$NE')/5 }'`;
          echo "$FileTime,$OUT" &gt;&gt; 600600ma5.txt
      fi

      I=$(($I+1));
  done &lt;600600.txt
</code></pre>

<p>```</p>

<pre><code>* 型如(600600ma5.txt)
        * 1993/09/02,13.22
        * 1993/09/03,13.036
        * 1993/09/06,13
        * 1993/09/07,12.94
        * 1993/09/08,12.806
</code></pre>

<ul>
<li>编写600600.gunplot脚本画出图像</li>
</ul>
</li>
</ul>
</li>
</ul>


<p>```bash</p>

<pre><code>            set datafile separator "," #设置数据文件分割符为,
            set xdata time          #设置x数据为时间类型
            set timefmt "%Y/%m/%d"  #设置时间格式 

            set grid    #设置网格

            set title '600600 青岛啤酒' #设置标题
            set xlabel '时间'       #设置X轴名称
            set ylabel '收盘价'     #设置y轴名称

            plot "./600600.txt" using 1:2 \
            title '600600' \
            with lines #points
            #使用600600.txt的1、2列画线，名称为600600，

            #set terminal png
            #set output "output2.png"

            replot "./600600ma5.txt" using 1:2 \
            title 'MA5'    \
            with lines#points
            #添加一条使用600600ma5.txt,即移动平均线数据，的线，名称为MA5

            #pause 10   # help pause 保持窗口
</code></pre>

<p>```</p>

<ul>
<li>使用gnuplot批处理模式运行600600.gunplot
              gnuplot> load &ldquo;./600600.gunplot&rdquo;

<ul>
<li>效果

<ul>
<li><img src="/images/600600&amp;MA5_withlinespoints.png" alt="600600&amp;MA5_withlinespoints" /></li>
<li><img src="/images/600600&amp;MA5_withlines.png" alt="600600&amp;MA5_withlines" /></li>
<li><img src="/images/600600scale.png" alt="600600scale" /></li>
<li><img src="/images/600600&amp;MA5_withlinespoints0629.png" alt="600600&amp;MA5_withlinespoints0629" /></li>
</ul>
</li>
</ul>
</li>
</ul>


<hr />

<hr />

<h1>simple Cat</h1>

<p>```c</p>

<h1>include &lt;stdio.h></h1>

<h1>include &lt;sys/stat.h></h1>

<h1>include &lt;malloc.h></h1>

<h1>include &lt;stdlib.h></h1>

<p>int main(int argc, char *argv[])
{</p>

<pre><code>FILE *fp;
int i, j, k = 1;
char a[] = "";


for (i = 0; i &lt; argc &amp;&amp; argv[i + 1] != NULL; i++)
{
    printf("\nargv[%d] is: %s\n", i + 1, argv[i + 1]);

    fp = fopen(argv[i + 1], "r");

    k = getFSSystemCall(argv[i + 1]);
    printf("FileSize:%d\n", k);

    // 请求动态内存
    char *a_p = a;
    a_p = (char *)malloc(sizeof(char) * k);
    if (a_p == NULL)
    {
        puts("malloc null");
        return 1;
    }


    if (fp == NULL)
    {
        printf("\e[1;31mNO SUCH FILE\e[0m\n\n");
        printInfo();
        return 1;
    }
    //size_t fread ( void   *buffer,  size_t size,  size_t count,  FILE *stream) ;
    //返回值：实际读取的元素个数.如果返回值与count不相同,则可能文件结尾或发生错误.
    for (j = 0; fread(a_p + j, sizeof(char), 1, fp) == 1; j++)
    {
        fseek(fp, j + 1, 0);
        printf("%c", *(a_p + j));
    }

    fclose(fp);
    // 释放
    free(a_p);
}
return 0;
</code></pre>

<p>}</p>

<p>int getFileSize(FILE * fps)
{</p>

<pre><code>fseek(fps, 0L, SEEK_END);
int size = ftell(fps);
// &lt;stdio.h&gt; long ftell( FILE *s )
// 返回s当前的文件位置
// 错误返回-1
return size;
</code></pre>

<p>}</p>

<p>// include &lt;sys/stat.h>
int getFSSystemCall(char *strFileName)
{</p>

<pre><code>struct stat temp;
stat(strFileName, &amp;temp);
return temp.st_size;
</code></pre>

<p>}</p>

<p>printInfo()
{</p>

<pre><code>printf("\e[1;33m1cat:simple cat Ver:0.0.3 20130528\e[0m\n");
printf("\e[1;33mAuthor:wuwenjie.tk\e[0m\n");
</code></pre>

<p>}
```</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[原油指数抓取+android浮动窗口Service]]></title>
    <link href="http://www.wuwenjie.tk/blog/2013/05/05/Crude-oil-index-grep-android-floating-window-Service/"/>
    <updated>2013-05-05T10:02:00+08:00</updated>
    <id>http://www.wuwenjie.tk/blog/2013/05/05/Crude-oil-index-grep-android-floating-window-Service</id>
    <content type="html"><![CDATA[<h1>1.原油指数抓取</h1>


<p>1.0 背景</p>

<p>ICBC工商银行推出的<a title="账户原油" href="http://www.icbc.com.cn/ICBC/%E9%87%91%E8%9E%8D%E5%B8%82%E5%9C%BA%E4%B8%93%E5%8C%BA/%E4%BA%A7%E5%93%81%E6%9C%8D%E5%8A%A1/%E6%8A%95%E8%B5%84%E4%BA%A4%E6%98%93%E7%B1%BB%E4%BA%A7%E5%93%81/%E8%B4%A6%E6%88%B7%E5%8E%9F%E6%B2%B9/default.htm" target="_blank">账户原油</a>，</p>

<!-- more -->


<p>以人民币交易是按照</p>

<p><span id="MyFreeTemplateUserControl"><a title="NYMEX" href="http://zh.wikipedia.org/wiki/%E7%B4%90%E7%B4%84%E5%95%86%E5%93%81%E6%9C%9F%E8%B2%A8%E4%BA%A4%E6%98%93%E6%89%80" target="_blank">纽约商业交易所</a>（NYMEX）</span></p>

<p><span id="MyFreeTemplateUserControl"><a title="西得克萨斯中间基原油" href="http://zh.wikipedia.org/wiki/%E8%A5%BF%E5%BE%97%E5%85%8B%E8%90%A8%E6%96%AF%E4%B8%AD%E9%97%B4%E5%9F%BA%E5%8E%9F%E6%B2%B9" target="_blank">西德克萨斯轻质低硫原油</a>期货合约（WTI）价格报价，</span></p>

<p><span id="MyFreeTemplateUserControl">以及账户国际原油参考洲际交易所（ICE）</span></p>

<p><span id="MyFreeTemplateUserControl"><a title="搜索/北海布伦特原油" href="http://zh.wikipedia.org/wiki/Special:%E6%90%9C%E7%B4%A2/%E5%8C%97%E6%B5%B7%E5%B8%83%E4%BC%A6%E7%89%B9%E5%8E%9F%E6%B2%B9" target="_blank">布伦特原油</a>期货合约（Brent）价格报价</span></p>

<p><span id="MyFreeTemplateUserControl">和综合考虑人民币与美元汇率报价的。</span></p>

<p>1.1 SHELL实现</p>

<p>&nbsp;</p>

<p>```bash</p>

<h1>!/bin/sh</h1>

<p>#</p>

<h1>抓取 wap.eastmoney.com 原油指数</h1>

<h1>最新价</h1>

<p>latestprice=&ldquo;&rdquo;;</p>

<h1>涨跌值</h1>

<p>Pricevalue=&ldquo;&rdquo;;</p>

<h1>涨跌幅</h1>

<p>risingAndfalling=&ldquo;&rdquo;;</p>

<h1>今开盘</h1>

<p>openingQuotation=&ldquo;&rdquo;;</p>

<h1>最高价</h1>

<p>ceilingprice=&ldquo;&rdquo;;</p>

<h1>最低价</h1>

<p>bottomprice=&ldquo;&rdquo;;</p>

<h1>昨收盘</h1>

<p>closingQuotation=&ldquo;&rdquo;;</p>

<h1>交易时间</h1>

<p>exchangehour=&ldquo;&rdquo;;</p>

<h1>分时图URL</h1>

<p>timeLine=&ldquo;&rdquo;;</p>

<h1>K线图</h1>

<p>KChart=&ldquo;&rdquo;;</p>

<h1>获得html</h1>

<p>wget -O conc.html -q &mdash;user-agent=&ldquo;Mobile Safari/534.30&rdquo; &mdash;no-cookies \
&mdash;referer=&ldquo;<a href="http://wap.eastmoney.com/Futures.aspx">http://wap.eastmoney.com/Futures.aspx</a>&rdquo; \
<a href="http://wap.eastmoney.com/FuturesInfo.aspx?c=CONC">http://wap.eastmoney.com/FuturesInfo.aspx?c=CONC</a></p>

<h1>最新价：.{7}(.{4,5})</h1>

<p>latestprice=&ldquo;<code>grep -o '最新价：.\{7\}\(.\{4,5\}\)' conc.html | awk 'gsub(/&amp;lt;[^&amp;gt;]*&amp;gt;/,"")'</code>&rdquo;</p>

<h1>gsub(r,s,t) 在字符串t中，用s替换和正则r匹配所有字符串 返回替换的个数。如果没有给出t，缺省为$0</h1>

<h1>涨跌值：.{45}(.{3,5}[0-9])</h1>

<p>Pricevalue=&ldquo;<code>grep -o '涨跌值：.\{45\}\(.\{3,5\}[0-9]\)' conc.html | awk 'gsub(/&amp;lt;[^&amp;gt;]*&amp;gt;/,"")'</code>&rdquo;</p>

<h1>涨跌幅：.{45}(.{4,5}%)</h1>

<p>risingAndfalling=&ldquo;<code>grep -o '涨跌幅：.\{45\}\(.\{4,5\}%\)' conc.html | awk 'gsub(/&amp;lt;[^&amp;gt;]*&amp;gt;/,"")'</code>&rdquo;</p>

<h1>今开盘：.{7}(.{3,5}[0-9])</h1>

<p>openingQuotation=&ldquo;<code>grep -o '今开盘：.\{7\}\(.\{3,5\}[0-9]\)' conc.html | awk 'gsub(/&amp;lt;[^&amp;gt;]*&amp;gt;/,"")'</code>&rdquo;</p>

<h1>最高价：.{7}(.{4,5}[0-9])</h1>

<p>ceilingprice=&ldquo;<code>grep -o '最高价：.\{7\}\(.\{4,5\}[0-9]\)' conc.html | awk 'gsub(/&amp;lt;[^&amp;gt;]*&amp;gt;/,"")'</code>&rdquo;</p>

<h1>最低价：.{7}(.{4,5}[0-9])</h1>

<p>bottomprice=&ldquo;<code>grep -o '最低价：.\{7\}\(.\{4,5\}[0-9]\)' conc.html | awk 'gsub(/&amp;lt;[^&amp;gt;]*&amp;gt;/,"")'</code>&rdquo;</p>

<h1>昨收盘：.{7}(.{4,5}[0-9])</h1>

<p>closingQuotation=&ldquo;<code>grep -o '昨收盘：.\{7\}\(.\{4,5\}[0-9]\)' conc.html | awk 'gsub(/&amp;lt;[^&amp;gt;]*&amp;gt;/,"")'</code>&rdquo;</p>

<h1>交易时间：.{7}(.{19})</h1>

<p>exchangehour=&ldquo;<code>grep -o '交易时间：.\{7\}\(.\{19\}\)' conc.html | awk 'gsub(/&amp;lt;[^&amp;gt;]*&amp;gt;/,"")'</code>&rdquo;</p>

<h1>分时图.<em>(ht.</em>)K</h1>

<p>timeLine=&ldquo;<code>grep -o '分时图.*\(ht.*\)K' conc.html|\
grep -o '\(http.*0\)'|awk 'gsub(/amp;/,"")'</code>&rdquo;</p>

<h1>获得分时图</h1>

<p>wget -O timeline.png -q &mdash;user-agent=&ldquo;Mobile Safari/534.30&rdquo; &mdash;no-cookies \
&mdash;referer=&ldquo;<a href="http://wap.eastmoney.com/Futures.aspx">http://wap.eastmoney.com/Futures.aspx</a>&rdquo; $timeLine</p>

<h1>获得k线图 K线图.<em>(ht.</em>C0)</h1>

<p>KChart=&ldquo;<code>grep -o 'K线图.*\(ht.*C0\)' conc.html|\
grep -o '\(http.*0\)'|awk 'gsub(/amp;/,"")'</code>&rdquo;;</p>

<p>wget -O KChart.png -q &mdash;user-agent=&ldquo;Mobile Safari/534.30&rdquo; &mdash;no-cookies \
&mdash;referer=&ldquo;<a href="http://wap.eastmoney.com/Futures.aspx">http://wap.eastmoney.com/Futures.aspx</a>&rdquo; $KChart</p>

<p>echo $latestprice
echo $Pricevalue
echo $risingAndfalling
echo $openingQuotation
echo $ceilingprice
echo $bottomprice
echo $closingQuotation
echo $exchangehour</p>

<h1>echo $timeLine</h1>

<h1>echo $KChart</h1>

<p>tPicPath=&ldquo;<code>pwd</code>&rdquo;&ldquo;/timeline.png&rdquo;;
KPicPath=&ldquo;<code>pwd</code>&rdquo;&ldquo;/KChart.png&rdquo;;</p>

<p>notify-send -t 20000 -i $tPicPath  &ldquo;$latestprice $Pricevalue&rdquo; &ldquo; $risingAndfalling $openingQuotation \
$ceilingpric $bottomprice $closingQuotation $exchangehour&rdquo;
```
注：grep 的正则表达式也许不准(在网页的改变下）</p>

<p>1.2 效果</p>

<p><img alt="效果" src="http://i.troll.ws/c914df5d.png" width="499" height="103" /></p>

<p>more:
<a href="http://www.icbc.com.cn/ICBC/%E9%87%91%E8%9E%8D%E5%B8%82%E5%9C%BA%E4%B8%93%E5%8C%BA/%E4%BA%A7%E5%93%81%E6%9C%8D%E5%8A%A1/%E6%8A%95%E8%B5%84%E4%BA%A4%E6%98%93%E7%B1%BB%E4%BA%A7%E5%93%81/%E8%B4%A6%E6%88%B7%E5%8E%9F%E6%B2%B9/default.htm" target="_blank">账户原油</a>
<a href="http://www.icbc.com.cn/icbc/%E9%87%91%E8%9E%8D%E5%B8%82%E5%9C%BA%E4%B8%93%E5%8C%BA/%E9%87%91%E8%9E%8D%E5%B8%82%E5%9C%BA%E5%AD%A6%E8%8B%91/%E7%83%AD%E7%82%B9%E9%97%AE%E7%AD%94/%E4%B8%AD%E5%9B%BD%E5%B7%A5%E5%95%86%E9%93%B6%E8%A1%8C%E8%B4%A6%E6%88%B7%E5%8E%9F%E6%B2%B9%E4%B8%9A%E5%8A%A1%E7%9F%A5%E8%AF%86%E9%97%AE%E7%AD%941.htm" target="_blank">中国工商银行账户原油业务知识问答</a>
<strong>2.android浮动窗口Service</strong></p>

<p><a title="FloatView.java" href="https://github.com/wuwenjie1992/Xhullo/blob/master/src/wo/wocom/xwell/view/FloatView.java" target="_blank">FloatView.java</a></p>

<p><a title="SV_FloateViewService" href="https://github.com/wuwenjie1992/Xhullo/blob/master/src/wo/wocom/xwell/service/SV_FloateViewService.java" target="_blank">SV_FloateViewService.java</a></p>

<p>```java
ComponentName component = new ComponentName
(this,wo.wocom.xwell.service.SV_FloateViewService.class);</code></p>

<p>// 组件名称，intent会根据component</p>

<p>// name启动一个组件（activity,service,contentProvider）</p>

<p>Intent mIntent01 = new Intent();</p>

<p>mIntent01.setComponent(component);</p>

<p>startService(mIntent01);
```</p>

<p>效果：</p>

<p><img alt="浮动窗口" src="http://i.troll.ws/ab5bef34.png" width="320" height="480" /></p>

<p>注：该版除屏幕外其他按键不能工作，</p>

<p>原因LayoutParams相关参数的设置（可能导致）</p>

<p>LayoutParams.FLAG_WATCH_OUTSIDE_TOUCH</p>

<h2>&nbsp;</h2>

<p>更新：</p>

<p>添加WindowManager.LayoutParams.flags的设置LayoutParams.FLAG_NOT_FOCUSABLE</p>

<p>//FLAG_NOT_FOCUSABLE Constant Value: 8 (0x00000008)不聚焦 可使实体按键反应//Window flag: this window won&rsquo;t ever get key input focus,
//so the user can not send key or other button events to it.</p>
]]></content>
  </entry>
  
</feed>
